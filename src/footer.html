
</main>
    <script>
        function toggleMenu() {
            const menu = document.getElementById("menu");
            menu.classList.toggle("open");
        }

  document.addEventListener("DOMContentLoaded", function () {
    const checkbox = document.querySelector("#darkmode");

    // Restore state
    const saved = localStorage.getItem("darkmode");
    if (saved !== null) {
      checkbox.checked = saved === "true";
    }

    // Save on change
    checkbox.addEventListener("change", function () {
      localStorage.setItem("darkmode", checkbox.checked);
    });
  });
</script>


<script>
(() => {
  const isTouch = matchMedia('(hover: none), (pointer: coarse)').matches;

  // Scroll lock (no jump-to-top)
  let lock = { on:false, y:0 };
  const lockScroll = () => {
    if (lock.on) return;
    lock.y = window.scrollY || document.documentElement.scrollTop || 0;
    Object.assign(document.body.style, {
      position:'fixed', top:`-${lock.y}px`, left:'0', right:'0', width:'100%', overflow:'hidden'
    });
    lock.on = true;
  };
  const unlockScroll = () => {
    if (!lock.on) return;
    Object.assign(document.body.style, {
      position:'', top:'', left:'', right:'', width:'', overflow:''
    });
    window.scrollTo(0, lock.y);
    lock.on = false;
  };

  const TAP_MAX_MOVE = 10, TAP_MAX_TIME = 500;

  const bind = (wrap) => {
    const target  = wrap.querySelector('.zoom-target');
    const close   = wrap.querySelector('.zoom-close');
    const dismiss = wrap.querySelector('.zoom-dismiss');
    if (!target || !close || !dismiss) return;

    const open = () => { 
      if (wrap.classList.contains('is-open')) return;
      wrap.classList.add('is-open'); 
      lockScroll(); 
    };
    const closeAll = () => { 
      if (!wrap.classList.contains('is-open')) return;
      wrap.classList.remove('is-open'); 
      unlockScroll(); 
    };
    const toggle = () => { wrap.classList.contains('is-open') ? closeAll() : open(); };

    // Always toggle on click (desktop + mobile browsers fire click after tap)
    target.addEventListener('click', (e) => { e.preventDefault(); toggle(); });

    // Touch-only: tap heuristic so vertical scroll isn't treated as a tap
    if (isTouch) {
      let id=null, sx=0, sy=0, st=0, moved=false;
      target.addEventListener('touchstart', (e) => {
        if (e.touches.length !== 1) { id=null; return; }
        const t = e.touches[0];
        id = t.identifier; sx = t.clientX; sy = t.clientY; st = performance.now(); moved = false;
      }, {passive:true});

      target.addEventListener('touchmove', (e) => {
        if (id==null) return;
        const t = [...e.touches].find(tt => tt.identifier===id); if (!t) return;
        if (Math.hypot(t.clientX - sx, t.clientY - sy) > TAP_MAX_MOVE) moved = true;
      }, {passive:true});

      target.addEventListener('touchend', (e) => {
        const t = e.changedTouches[0]; if (id!=null && t.identifier!==id) return;
        const tap = !moved && (performance.now()-st) <= TAP_MAX_TIME && e.touches.length===0;
        if (tap) { e.preventDefault(); e.stopPropagation(); toggle(); }
        id=null;
      }, {passive:false});
    }

    // Close handlers (apply to ALL devices)
    const closeHandler = (e) => { e.preventDefault(); e.stopPropagation(); closeAll(); };
    close.addEventListener('click', closeHandler, {passive:false});
    dismiss.addEventListener('click', closeHandler, {passive:false});
    // Also support touchend for good measure (no-op on desktop)
    close.addEventListener('touchend', closeHandler, {passive:false});
    dismiss.addEventListener('touchend', closeHandler, {passive:false});
  };

  // Bind all wrappers
  document.querySelectorAll('.zoom-wrapper').forEach(bind);

  // One global ESC handler closes whichever zoom is open
  document.addEventListener('keydown', (e) => {
    if (e.key !== 'Escape') return;
    const openWrap = document.querySelector('.zoom-wrapper.is-open');
    if (!openWrap) return;
    // mimic closeAll() for that wrapper
    openWrap.classList.remove('is-open');
    unlockScroll();
  });
})();
</script>

</body>
</html>
